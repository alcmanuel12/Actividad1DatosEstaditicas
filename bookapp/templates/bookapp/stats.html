{% extends 'bookapp/layout.html' %}

{% block content %}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <div style="width: 80%; margin: 0 auto; padding: 20px;">
        <h1>Estadísticas de la Librería</h1>
        <a href="{% url 'book_list' %}">&larr; Volver a la lista</a>
        <hr>

        <div style="display: flex; gap: 20px; margin-bottom: 40px;">
            <div style="border: 1px solid #ddd; padding: 15px; border-radius: 8px; flex: 1; background: #f9f9f9;">
                <h3>Libro más largo</h3>
                <p><strong>{{ max_pages_book.title }}</strong></p>
                <p>{{ max_pages_book.pages }} páginas</p>
            </div>
            <div style="border: 1px solid #ddd; padding: 15px; border-radius: 8px; flex: 1; background: #f9f9f9;">
                <h3>Libro más corto</h3>
                <p><strong>{{ min_pages_book.title }}</strong></p>
                <p>{{ min_pages_book.pages }} páginas</p>
            </div>
            <div style="border: 1px solid #ddd; padding: 15px; border-radius: 8px; flex: 1; background: #f9f9f9;">
                <h3>Promedios</h3>
                <p>Páginas: {{ avg_pages|floatform:1 }}</p>
                <p>Rating: {{ avg_rating|floatform:1 }} / 5</p>
            </div>
        </div>

        <div style="display: flex; justify-content: space-around; flex-wrap: wrap;">
            <div style="width: 45%; min-width: 300px;">
                <h3 style="text-align: center;">Estado de Lectura</h3>
                <canvas id="statusChart"></canvas>
            </div>
            <div style="width: 45%; min-width: 300px;">
                <h3 style="text-align: center;">Distribución de Ratings</h3>
                <canvas id="ratingChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        const statusData = {
            labels: {{ chart_status_labels|safe }},
            datasets: [{
                data: {{ chart_status_values|safe }},
                backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0']
            }]
        };

        const ratingData = {
            labels: {{ chart_rating_labels|safe }},
            datasets: [{
                label: 'Número de Libros',
                data: {{ chart_rating_values|safe }},
                backgroundColor: '#36A2EB'
            }]
        };

        new Chart(document.getElementById('statusChart'), { type: 'pie', data: statusData });
        new Chart(document.getElementById('ratingChart'), { 
            type: 'bar', 
            data: ratingData,
            options: { scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } } }
        });
    </script>
{% endblock content %}